{% extends 'base.html' %}
{% load static %}
{% block content %}

{% if user.is_authenticated %}
  <h1 class="mb-4">Tenants</h1>

  <!-- Occupancy filter -->
  <form method="GET" action="{% url 'home' %}" class="mb-4 d-flex align-items-center gap-2">
    <label for="occupancy_filter" class="form-label mb-0">Filter by Occupancy:</label>
    <select name="occupancy" id="occupancy_filter" class="form-select w-auto" onchange="this.form.submit()">
      <option value="" {% if not request.GET.occupancy %}selected{% endif %}>All</option>
      <option value="occupied" {% if request.GET.occupancy == 'occupied' %}selected{% endif %}>Occupied</option>
      <option value="vacant" {% if request.GET.occupancy == 'vacant' %}selected{% endif %}>Vacant</option>
    </select>
  </form>

  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>Name</th>
          <th>Phone</th>
          <th>Email</th>
          <th>Address</th>
          <th>Postcode</th>
          <th>Next Of Kin</th>
          <th>Move In</th>
          <th>Key Collected</th>
          <th>Move Out</th>
          <th>Key Dropped</th>
          <th>Current Residence</th>
          <th>Occupancy</th>
          <th>ID</th>
        </tr>
      </thead>
      <tbody>
        {% for record in records %}
          <tr>
            <td>
            <a href="{% url 'record' record.id %}" class="text-decoration-none">
            {{ record.first_name }} {{ record.last_name }}</a></td>
            <td>{{ record.phone }}</td>
            <td>{{ record.email }}</td>
            <td>{{ record.address }}</td>
            <td>{{ record.postcode }}</td>
            <td>{{ record.next_of_kin }}</td>
            <td>{{ record.move_in_date }}</td>
            <td>{{ record.key_collection }}</td>
            <td>{{ record.move_out_date }}</td>
            <td>{{ record.key_drop_off }}</td>
            <td>{{ record.current_residence }}</td>
            <td>
              {% if record.occupancy_status == 'occupied' %}
                <span class="badge bg-danger">Occupied</span>
              {% elif record.occupancy_status == 'vacant' %}
                <span class="badge bg-success">Vacant</span>
              {% else %}
                <span class="badge bg-secondary">{{ record.occupancy_status }}</span>
              {% endif %}
            </td>
            <td>
              <a href="{% url 'record' record.id %}" class="btn btn-sm btn-outline-primary">{{ record.id }}</a>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="13" class="text-center">No tenant records found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

{% else %}
  <h2 class="mb-4">Login</h2>
  <form method="POST" action="{% url 'home' %}" class="w-50 mx-auto border p-4 rounded-3 shadow-sm bg-light">
    {% csrf_token %}
    <div class="mb-3">
      <input type="text" class="form-control" name="username" placeholder="Username" required autofocus />
    </div>
    <div class="mb-3">
      <input type="password" class="form-control" name="password" placeholder="Password" required />
    </div>
    <button type="submit" class="btn btn-primary w-100">Login</button>
  </form>
{% endif %}

{% endblock %}
